<div
  class="min-h-screen bg-slate-50 dark:bg-slate-950 font-sans text-slate-900 dark:text-slate-100 transition-colors duration-300">
  <div class="max-w-[1600px] mx-auto px-6 h-20 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <div class="relative group cursor-pointer">
        <div
          class="w-12 h-12 rounded-2xl overflow-hidden ring-2 ring-slate-100 dark:ring-slate-800 shadow-lg transition-transform group-hover:scale-105">
          <img [src]="currentUser.profilePicture" class="w-full h-full object-cover" [alt]="username">
        </div>
        <div
          class="absolute -bottom-1 -right-1 w-4 h-4 bg-emerald-500 border-4 border-white dark:border-slate-950 rounded-full">
        </div>
      </div>
      <div>
        <h1 class="text-xl font-black tracking-tight">System Dashboard</h1>
        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{{ today | date:'fullDate' }}</p>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <app-notifications class="hidden md:block"></app-notifications>
      <button (click)="openAddProductModal()"
        class="bg-slate-900 dark:bg-white dark:text-slate-900 text-white px-6 py-3 rounded-2xl font-bold text-sm shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2">
        <ng-icon name="heroPlus" stroke-width="3"></ng-icon>
        <span class="hidden sm:inline">Add Product</span>
      </button>
    </div>
  </div>

  <main class="max-w-[1600px] mx-auto px-6 py-10">
    <section class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-12">

      <div
        class="lg:col-span-5 bg-slate-900 dark:bg-indigo-950 p-8 rounded-[3rem] text-white shadow-2xl relative overflow-hidden group border border-white/5">
        <div class="relative z-10 flex flex-col h-full justify-between">
          <div class="flex justify-between items-start">
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span
                  class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.8)]"></span>
                <p class="text-[10px] font-black uppercase tracking-[0.2em] text-indigo-300">Core Engine Active</p>
              </div>
              <h3 class="text-3xl font-black tracking-tighter">Inventory Ledger</h3>
            </div>
            <div class="text-right">
              <p class="text-3xl font-mono font-bold text-white">{{ stats.totalProducts }}</p>
              <p class="text-[9px] font-bold uppercase opacity-50 tracking-widest text-indigo-200 text-nowrap">Managed
                SKUs</p>
            </div>
          </div>

          <div class="flex items-end gap-1.5 h-20 mt-8 mb-4">
            <div *ngFor="let p of products.slice(0, 15)"
              class="flex-1 bg-indigo-500/30 rounded-full transition-all duration-700 group-hover:bg-indigo-400 group-hover:shadow-[0_0_10px_rgba(129,140,248,0.5)]"
              [style.height.%]="p.stock > 100 ? 100 : p.stock" [title]="p.name + ': ' + p.stock">
            </div>
          </div>

          <div class="flex justify-between items-center pt-6 border-t border-white/10">
            <div class="flex items-center gap-3">
              <div class="flex -space-x-2">
                <div
                  class="w-8 h-8 rounded-full border-2 border-slate-900 bg-slate-800 flex items-center justify-center text-[10px] font-bold">
                  A</div>
                <div
                  class="w-8 h-8 rounded-full border-2 border-slate-900 bg-indigo-600 flex items-center justify-center text-[10px] font-bold shadow-lg">
                  <ng-icon name="heroCheckBadge" size="14"></ng-icon>
                </div>
              </div>
              <span class="text-[10px] font-bold text-indigo-300 uppercase tracking-tight">Verified Session</span>
            </div>
            <button
              class="group/btn relative text-[10px] font-black uppercase tracking-widest px-5 py-2.5 bg-white/10 hover:bg-white/20 border border-white/10 rounded-xl transition-all active:scale-95">
              <span class="flex items-center gap-2">
                <ng-icon name="heroShieldCheck" size="14" class="text-indigo-300"></ng-icon>
                System Audit
              </span>
            </button>
          </div>
        </div>
        <ng-icon name="heroCpuChip" size="160"
          class="absolute -right-10 -bottom-10 opacity-[0.05] rotate-12 group-hover:rotate-0 transition-transform duration-1000"></ng-icon>
      </div>

      <div class="lg:col-span-3 flex flex-col gap-6">
        <div (click)="searchTerm = 'low stock'; applyFilter()"
          class="flex-1 bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-[2.5rem] p-7 cursor-pointer hover:shadow-2xl hover:shadow-rose-500/10 hover:border-rose-500 transition-all group relative overflow-hidden">
          <div class="relative z-10">
            <div class="flex justify-between items-center mb-4">
              <div
                class="p-3 bg-rose-50 dark:bg-rose-900/30 rounded-2xl text-rose-600 group-hover:scale-110 group-hover:rotate-12 transition-all">
                <ng-icon name="heroExclamationTriangle" size="24"></ng-icon>
              </div>
              <span class="text-3xl font-black text-slate-900 dark:text-white">{{ stats.lowStock }}</span>
            </div>
            <p class="text-[11px] font-black text-slate-400 uppercase tracking-[0.15em]">Critical Items</p>
            <p
              class="text-[9px] font-bold text-rose-500 uppercase mt-1 opacity-0 group-hover:opacity-100 transition-opacity">
              Click to Analyze</p>
          </div>
          <div
            class="absolute right-0 bottom-0 translate-x-1/4 translate-y-1/4 opacity-[0.03] dark:opacity-[0.1] group-hover:scale-110 transition-transform">
            <ng-icon name="heroFire" size="100" class="text-rose-500"></ng-icon>
          </div>
        </div>

        <div
          class="flex-1 bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-[2.5rem] p-7 shadow-sm relative overflow-hidden group">
          <div class="flex justify-between items-center mb-4">
            <div
              class="p-3 bg-emerald-50 dark:bg-emerald-900/30 rounded-2xl text-emerald-600 group-hover:scale-110 transition-transform">
              <ng-icon name="heroPresentationChartLine" size="24"></ng-icon>
            </div>
            <span class="text-2xl font-black text-slate-900 dark:text-white">${{ (stats.totalValue) | number:'1.0-0'
              }}</span>
          </div>
          <p class="text-[11px] font-black text-slate-400 uppercase tracking-[0.15em]">Liquid Assets</p>
          <div class="absolute right-0 bottom-0 translate-x-1/4 translate-y-1/4 opacity-[0.03] dark:opacity-[0.1]">
            <ng-icon name="heroBanknotes" size="100" class="text-emerald-500"></ng-icon>
          </div>
        </div>
      </div>

      <div
        class="lg:col-span-4 bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-[3rem] p-8 shadow-sm">
        <div class="flex items-center gap-2 mb-8">
          <div class="p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg">
            <ng-icon name="heroChartPie" class="text-indigo-500" size="18"></ng-icon>
          </div>
          <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Asset Distribution</h3>
        </div>

        <div class="space-y-6">
          <div *ngFor="let cat of categoryStats.slice(0, 4)" class="group cursor-default">
            <div class="flex justify-between text-[11px] font-black mb-2 uppercase tracking-tight">
              <span class="text-slate-600 dark:text-slate-400 group-hover:text-indigo-500 transition-colors">{{ cat.name
                }}</span>
              <span class="text-slate-900 dark:text-white">{{ cat.percentage | number:'1.0-1' }}%</span>
            </div>
            <div class="h-2 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
              <div
                class="h-full bg-slate-900 dark:bg-indigo-500 transition-all duration-1000 ease-out shadow-[0_0_8px_rgba(99,102,241,0.4)]"
                [style.width.%]="cat.percentage"></div>
            </div>
          </div>

          <div class="pt-6 mt-2 border-t border-slate-50 dark:border-slate-800 flex justify-between items-center">
            <span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">Global Status</span>
            <div class="flex items-center gap-1.5">
              <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></span>
              <span class="text-[9px] font-black text-emerald-500 uppercase">Optimized</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div
      class="bg-white dark:bg-slate-900 rounded-[3rem] border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden mb-12">
      <div class="p-8 flex flex-col md:flex-row justify-between items-center gap-6 bg-slate-50/30 dark:bg-slate-800/20">
        <div>
          <div class="flex items-center gap-2 mb-1">
            <span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
            <h3 class="text-2xl font-black tracking-tight text-slate-900 dark:text-white">Live Inventory Ledger</h3>
          </div>
          <p class="text-slate-400 text-sm font-medium">Real-time stock monitoring and asset valuation.</p>
        </div>

        <div class="flex items-center gap-3 w-full md:w-auto">
          <div class="relative flex-1 md:w-80 group">
            <ng-icon name="heroMagnifyingGlass" size="18"
              class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors"></ng-icon>
            <input type="text" placeholder="Search by SKU, Name..." [(ngModel)]="searchTerm" (input)="applyFilter()"
              class="w-full pl-14 pr-6 py-4 bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 border rounded-2xl text-sm font-semibold focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all">
          </div>
        </div>
      </div>

      <div class="overflow-x-auto px-4 pb-4">
        <table class="w-full text-left border-separate border-spacing-y-2">
          <thead>
            <tr class="text-slate-400 text-[10px] uppercase font-black tracking-[0.2em]">
              <th class="px-6 py-4">
                <input type="checkbox" (change)="toggleAll($event)" class="rounded border-slate-300">
              </th>
              <th class="px-6 py-4">Product Detail</th>
              <th class="px-6 py-4">Category</th>
              <th class="px-6 py-4">Stock Status</th>
              <th class="px-6 py-4">Unit Price</th>
              <th class="px-6 py-4 text-right">Operations</th>
            </tr>
          </thead>
          <tbody class="divide-y-0">
            <tr *ngIf="isLoading">
              <td colspan="6" class="px-6 py-10 text-center">
                <div class="flex flex-col items-center gap-2">
                  <div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                  <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Syncing Ledger...</span>
                </div>
              </td>
            </tr>

            <tr *ngFor="let p of filteredProducts"
              class="group bg-white dark:bg-slate-900 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all duration-200 shadow-sm border border-slate-100 dark:border-slate-800">
              <td class="px-6 py-5 first:rounded-l-2xl border-y border-l border-slate-100 dark:border-slate-800">
                <input type="checkbox" [checked]="isSelected(p._id)" (change)="toggleSelection(p._id)"
                  class="rounded border-slate-300">
              </td>
              <td class="px-6 py-5 border-y border-slate-100 dark:border-slate-800">
                <div class="flex items-center gap-4">
                  <div
                    class="w-12 h-12 rounded-xl bg-slate-100 dark:bg-slate-800 overflow-hidden shadow-inner flex-shrink-0">
                    <img [src]="'http://16.176.174.48:5000/' + p.image" (error)="onImageError($event)"
                      class="w-full h-full object-cover">
                  </div>
                  <div class="flex flex-col">
                    <span class="text-slate-900 dark:text-white font-bold">{{ p.name }}</span>
                    <span class="text-[10px] text-slate-400 font-mono tracking-wider uppercase">SKU-{{ p._id.slice(-6)
                      }}</span>
                  </div>
                </div>
              </td>
              <td class="px-6 py-5 border-y border-slate-100 dark:border-slate-800">
                <div
                  class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-50/50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-lg text-[11px] font-bold uppercase">
                  <ng-icon name="heroTag" size="12"></ng-icon>{{ p.category?.name || 'Uncategorized' }}
                </div>
              </td>
              <td class="px-6 py-5 border-y border-slate-100 dark:border-slate-800">
                <div class="flex flex-col gap-1.5 w-40">
                  <div class="flex justify-between items-end">
                    <span class="text-[11px] font-black" [class.text-rose-500]="p.stock <= 5">
                      {{ p.stock }} <span class="text-[9px] font-medium text-slate-400">AVAIL</span>
                    </span>
                    <span *ngIf="p.stock <= 5"
                      class="text-[9px] font-black text-rose-500 px-1 bg-rose-50 dark:bg-rose-900/30 rounded">LOW</span>
                  </div>
                  <div class="w-full h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                    <div class="h-full rounded-full transition-all duration-1000"
                      [ngClass]="p.stock <= 5 ? 'bg-rose-500' : 'bg-slate-900 dark:bg-blue-500'"
                      [style.width.%]="p.stock > 100 ? 100 : (p.stock * 1)"></div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-5 border-y border-slate-100 dark:border-slate-800 text-base font-black tracking-tight">
                ${{ p.price | number:'1.2-2' }}
              </td>
              <td
                class="px-6 py-5 last:rounded-r-2xl border-y border-r border-slate-100 dark:border-slate-800 text-right">
                <div class="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-all">
                  <button
                    class="w-10 h-10 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-400 hover:text-blue-600 flex items-center justify-center transition-colors">
                    <ng-icon name="heroPencilSquare" size="16"></ng-icon>
                  </button>
                  <button (click)="deleteProduct(p._id)"
                    class="w-10 h-10 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-400 hover:text-rose-600 flex items-center justify-center transition-colors">
                    <ng-icon name="heroTrash" size="16"></ng-icon>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <section class="mb-12">
      <div class="flex items-center gap-2 mb-4 px-2">
        <ng-icon name="heroExclamationTriangle" class="text-rose-500" size="18"></ng-icon>
        <h3 class="text-sm font-black text-slate-900 dark:text-white uppercase tracking-widest">Critical Stock Alerts
        </h3>
      </div>
      <div
        class="bg-white dark:bg-slate-900 rounded-[2.5rem] border border-rose-100 dark:border-rose-900/20 overflow-hidden shadow-sm">
        <table class="w-full text-left">
          <thead class="bg-rose-50/50 dark:bg-rose-900/10 text-[10px] font-black uppercase text-rose-600">
            <tr>
              <th class="px-8 py-4">Urgency</th>
              <th class="px-8 py-4">Product Name</th>
              <th class="px-8 py-4">Current Stock</th>
              <th class="px-8 py-4 text-right">Procurement</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
            <tr *ngFor="let p of getLowStockItems()"
              class="hover:bg-rose-50/30 dark:hover:bg-rose-900/10 transition-colors">
              <td class="px-8 py-5">
                <span [class]="p.stock === 0 ? 'bg-rose-600 text-white' : 'bg-amber-100 text-amber-700'"
                  class="px-2 py-1 rounded text-[9px] font-black uppercase">
                  {{ p.stock === 0 ? 'Out of Stock' : 'Low Stock' }}
                </span>
              </td>
              <td class="px-8 py-5 font-bold text-slate-700 dark:text-slate-200">{{ p.name }}</td>
              <td class="px-8 py-5 font-mono text-rose-500 font-bold">{{ p.stock }} units remaining</td>
              <td class="px-8 py-5 text-right">
                <button class="text-blue-600 font-black text-[10px] uppercase tracking-tighter hover:underline">Generate
                  Order</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-20">
      <div
        class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-sm">
        <div class="flex justify-between items-center mb-8">
          <h3 class="text-sm font-black text-slate-900 dark:text-white uppercase tracking-widest">Asset Distribution
          </h3>
          <span class="text-[10px] font-bold text-slate-400 px-2 py-1 bg-slate-100 dark:bg-slate-800 rounded">By
            Valuation</span>
        </div>
        <div class="space-y-6">
          <div *ngFor="let cat of categoryStats" class="group">
            <div class="flex justify-between text-xs mb-2">
              <span class="font-bold text-slate-600 dark:text-slate-400">{{ cat.name }}</span>
              <span class="font-mono font-black text-slate-900 dark:text-white">${{ cat.value | number:'1.0-0' }}</span>
            </div>
            <div class="h-2.5 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
              <div class="h-full bg-blue-500 group-hover:bg-blue-400 transition-all duration-1000"
                [style.width.%]="cat.percentage"></div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-sm">
        <h3 class="text-sm font-black text-slate-900 dark:text-white uppercase tracking-widest mb-8">Operational Logs
        </h3>
        <div class="space-y-6">
          <div class="flex gap-4 items-start pb-4 border-b border-slate-50 dark:border-slate-800/50">
            <div
              class="w-10 h-10 rounded-2xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center text-emerald-600">
              <ng-icon name="heroCheckCircle" size="20"></ng-icon>
            </div>
            <div>
              <p class="text-xs text-slate-700 dark:text-slate-300 font-bold">Cloud Inventory Synchronized</p>
              <p class="text-[10px] text-slate-400 mt-0.5">Global ledger updated with EC2 Production instance.</p>
              <span class="text-[9px] font-mono text-slate-400 uppercase mt-2 block">12:44 PM · SYSTEM_AUTO</span>
            </div>
          </div>
          <div class="flex gap-4 items-start">
            <div
              class="w-10 h-10 rounded-2xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600">
              <ng-icon name="heroUserCircle" size="20"></ng-icon>
            </div>
            <div>
              <p class="text-xs text-slate-700 dark:text-slate-300 font-bold">New Asset Entry Created</p>
              <p class="text-[10px] text-slate-400 mt-0.5">Admin initialized SKU-88291 via Dashboard Controller.</p>
              <span class="text-[9px] font-mono text-slate-400 uppercase mt-2 block">10:15 AM · ADMIN_PHU</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

<app-confirm-dialog
  *ngIf="showDeleteDialog"
  title="Confirm Deletion"
  message="Are you sure you want to remove this product? This action cannot be undone."
  confirmText="Delete Product"
  type="danger"
  (confirmed)="confirmDeletion()"
  (cancelled)="showDeleteDialog = false">
</app-confirm-dialog>

  <app-add-product *ngIf="showAddProductModal" (productAdded)="onProductAdded($event)"
    (close)="closeAddProductModal()"></app-add-product>
</div>