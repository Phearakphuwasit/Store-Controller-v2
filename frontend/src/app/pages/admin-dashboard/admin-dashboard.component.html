<div
  class="min-h-screen bg-slate-50 dark:bg-slate-950 font-sans text-slate-900 dark:text-slate-100 transition-colors duration-300">
  <div class="max-w-[1600px] mx-auto px-6 h-20 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <div class="relative group cursor-pointer">
        <div
          class="w-12 h-12 rounded-2xl overflow-hidden ring-2 ring-slate-100 dark:ring-slate-800 shadow-lg transition-transform group-hover:scale-105">
          <img [src]="currentUser.profilePicture" class="w-full h-full object-cover" [alt]="username">
        </div>
        <div
          class="absolute -bottom-1 -right-1 w-4 h-4 bg-emerald-500 border-4 border-white dark:border-slate-950 rounded-full">
        </div>
      </div>
      <div>
        <h1 class="text-xl font-black tracking-tight">System Dashboard</h1>
        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{{ today | date:'fullDate' }}</p>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <app-notifications class="hidden md:block"></app-notifications>
      <button (click)="openAddProductModal()"
        class="bg-slate-900 dark:bg-white dark:text-slate-900 text-white px-6 py-3 rounded-2xl font-bold text-sm shadow-xl shadow-slate-200 dark:shadow-none hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2">
        <ng-icon name="heroPlus" stroke-width="3"></ng-icon>
        <span class="hidden sm:inline">Add Product</span>
      </button>
    </div>
  </div>

  <main class="max-w-[1600px] mx-auto px-6 py-10">
    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
      <div
        class="bg-gradient-to-br from-indigo-600 to-blue-700 p-6 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden group">
        <div class="relative z-10">
          <div class="flex items-center gap-2 mb-4">
            <div class="p-2 bg-white/20 rounded-lg backdrop-blur-md">
              <ng-icon name="heroTrophy" size="18"></ng-icon>
            </div>
            <span class="text-[10px] font-black uppercase tracking-widest opacity-80">Best Seller</span>
          </div>
          <h3 class="text-xl font-bold truncate">{{ stats.bestSellerName }}</h3>
          <p class="text-sm opacity-70 mt-1">High demand item</p>
        </div>
        <ng-icon name="heroSparkles" size="80"
          class="absolute -right-4 -bottom-4 opacity-10 group-hover:scale-110 transition-transform"></ng-icon>
      </div>

      <div
        class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-sm">
        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Stock Health</p>
        <div class="flex items-end gap-2 h-12">
          <div class="flex-1 bg-emerald-500 rounded-t-md transition-all hover:opacity-80" [style.height.%]="80"></div>
          <div class="flex-1 bg-amber-400 rounded-t-md transition-all hover:opacity-80" [style.height.%]="40"></div>
          <div class="flex-1 bg-rose-500 rounded-t-md transition-all hover:opacity-80" [style.height.%]="20"></div>
        </div>
        <div class="flex justify-between mt-3 text-[9px] font-black text-slate-400 uppercase">
          <span>Good</span>
          <span>Critical</span>
        </div>
      </div>

      <div
        class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-sm">
        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Total Assets</p>
        <h3 class="text-4xl font-black text-slate-900 dark:text-white">{{ stats.totalProducts }}</h3>
        <div class="mt-4 flex items-center gap-2 text-emerald-500 font-bold text-xs">
          <ng-icon name="heroArrowTrendingUp"></ng-icon> +2.4% <span
            class="text-slate-400 font-medium italic">growth</span>
        </div>
      </div>

      <div class="bg-slate-900 dark:bg-blue-600 p-6 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden">
        <p class="text-white/60 text-[10px] font-black uppercase tracking-widest mb-1">Inventory Valuation</p>
        <h3 class="text-3xl font-black tracking-tighter">${{ stats.totalValue | number:'1.0-0' }}</h3>
        <div class="absolute -right-4 -bottom-4 opacity-10">
          <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.97 0-1.8 1.39-3.06 3.11-3.41V4h2.67v1.94c1.47.31 2.82 1.22 2.94 3.1h-1.89c-.17-.91-.73-1.66-2.39-1.66-1.58 0-2.25.75-2.25 1.48 0 .77.58 1.41 2.82 1.97 2.61.64 4.04 1.76 4.04 4.02 0 1.94-1.44 3.29-3.37 3.66z" />
          </svg>
        </div>
      </div>
    </section>

    <div
      class="bg-white dark:bg-slate-900 rounded-[3rem] border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden">

      <div class="p-8 flex flex-col md:flex-row justify-between items-center gap-6 bg-slate-50/30 dark:bg-slate-800/20">
        <div>
          <div class="flex items-center gap-2 mb-1">
            <span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
            <h3 class="text-2xl font-black tracking-tight text-slate-900 dark:text-white">Live Inventory Ledger</h3>
          </div>
          <p class="text-slate-400 text-sm font-medium">Real-time stock monitoring and asset valuation.</p>
        </div>

        <div class="flex items-center gap-3 w-full md:w-auto">
          <div class="relative flex-1 md:w-80 group">
            <ng-icon name="heroMagnifyingGlass" size="18"
              class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors"></ng-icon>
            <input type="text" placeholder="Search by SKU, Name..." [(ngModel)]="searchTerm" (input)="applyFilter()"
              class="w-full pl-14 pr-6 py-4 bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 border rounded-2xl text-sm font-semibold focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all">
          </div>
          <button
            class="w-12 h-12 flex items-center justify-center rounded-2xl border border-slate-200 dark:border-slate-700 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition">
            <ng-icon name="heroAdjustmentsHorizontal" size="20"></ng-icon>
          </button>
        </div>
      </div>

      <div class="overflow-x-auto px-4 pb-4">
        <table class="w-full text-left border-separate border-spacing-y-2">
          <thead>
            <tr class="text-slate-400 text-[10px] uppercase font-black tracking-[0.2em]">
              <th class="px-6 py-4">Product Detail</th>
              <th class="px-6 py-4">Category</th>
              <th class="px-6 py-4">Stock Status</th>
              <th class="px-6 py-4">Unit Price</th>
              <th class="px-6 py-4 text-right">Operations</th>
            </tr>
          </thead>

          <tbody class="divide-y-0">
            <tr *ngIf="isLoading">
              <td colspan="5" class="px-6 py-10 text-center">
                <div class="flex flex-col items-center gap-2">
                  <div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                  <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Syncing Ledger...</span>
                </div>
              </td>
            </tr>

            <tr *ngFor="let p of filteredProducts"
              class="group bg-white dark:bg-slate-900 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all duration-200 shadow-sm border border-slate-100 dark:border-slate-800">
              <td class="px-6 py-5 first:rounded-l-2xl border-y border-l border-slate-100 dark:border-slate-800">
                <div class="flex items-center gap-4">
                  <div
                    class="w-12 h-12 rounded-xl bg-slate-100 dark:bg-slate-800 overflow-hidden shadow-inner flex-shrink-0">
                    <img [src]="'http://http://16.176.174.48/:5000/' + p.image" (error)="onImageError($event)"
                      class="w-full h-full object-cover">
                  </div>
                  <div class="flex flex-col">
                    <span class="text-slate-900 dark:text-white font-bold">{{ p.name }}</span>
                    <span class="text-[10px] text-slate-400 font-mono tracking-wider uppercase">SKU-{{ p._id.slice(-6)
                      }}</span>
                  </div>
                </div>
              </td>

              <td class="px-6 py-5 border-y border-slate-100 dark:border-slate-800">
                <div
                  class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-50/50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-lg text-[11px] font-bold uppercase">
                  <ng-icon name="heroTag" size="12"></ng-icon>

                  {{ p.category?.name || 'Uncategorized' }}
                </div>
              </td>

              <td class="px-6 py-5 border-y border-slate-100 dark:border-slate-800">
                <div class="flex flex-col gap-1.5 w-40">
                  <div class="flex justify-between items-end">
                    <span class="text-[11px] font-black" [class.text-rose-500]="p.stock <= 5">
                      {{ p.stock }} <span class="text-[9px] font-medium text-slate-400">AVAIL</span>
                    </span>
                    <span *ngIf="p.stock <= 5"
                      class="text-[9px] font-black text-rose-500 px-1 bg-rose-50 dark:bg-rose-900/30 rounded">LOW</span>
                  </div>
                  <div class="w-full h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                    <div class="h-full rounded-full transition-all duration-1000"
                      [ngClass]="p.stock <= 5 ? 'bg-rose-500' : 'bg-slate-900 dark:bg-blue-500'"
                      [style.width.%]="p.stock > 100 ? 100 : (p.stock * 1)"></div>
                  </div>
                </div>
              </td>

              <td class="px-6 py-5 border-y border-slate-100 dark:border-slate-800 text-base font-black tracking-tight">
                ${{ p.price | number:'1.2-2' }}
              </td>

              <td
                class="px-6 py-5 last:rounded-r-2xl border-y border-r border-slate-100 dark:border-slate-800 text-right">
                <div class="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-all">
                  <button
                    class="w-10 h-10 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-400 hover:text-blue-600 flex items-center justify-center transition-colors">
                    <ng-icon name="heroPencilSquare" size="16"></ng-icon>
                  </button>
                  <button (click)="deleteProduct(p._id)"
                    class="w-10 h-10 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-400 hover:text-rose-600 flex items-center justify-center transition-colors">
                    <ng-icon name="heroTrash" size="16"></ng-icon>
                  </button>
                </div>
              </td>
            </tr>

            <tr *ngIf="!isLoading && filteredProducts.length === 0">
              <td colspan="5" class="px-10 py-32 text-center">
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <app-add-product *ngIf="showAddProductModal" (productAdded)="onProductAdded($event)"
    (close)="closeAddProductModal()"></app-add-product>
</div>